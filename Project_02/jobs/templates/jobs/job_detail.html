{% extends 'base.html' %}
{% block title %}{{ object.title }} Â· Freelance Marketplace{% endblock %}
{% block content %}
  <a href="/jobs/"><i class="bi bi-arrow-left"></i> Back to Jobs</a>
  <div class="d-flex align-items-start mt-2">
    <div class="flex-grow-1">
      <h1 class="mb-1">{{ object.title }}</h1>
      <p class="text-muted"><i class="bi bi-cash-stack"></i> ${{ object.budget }}</p>
      <p>
        Status:
        {% if object.status == 'completed' %}
          <span class="badge bg-success">Completed</span>
        {% elif object.status == 'ongoing' %}
          <span class="badge bg-primary">Ongoing</span>
        {% else %}
          <span class="badge bg-secondary">Pending offers</span>
        {% endif %}
      </p>
      <p>{{ object.description }}</p>
      <p class="text-muted">Posted by {{ object.created_by.username }} on {{ object.created_at|date:"M d, Y" }}</p>
      {% if object.contact_email %}
        <p><i class="bi bi-envelope"></i> <a href="mailto:{{ object.contact_email }}">{{ object.contact_email }}</a></p>
      {% endif %}
    </div>
  </div>

  <div class="mt-3">
    {% if user.is_authenticated and user == object.created_by %}
      <form method="post" action="/jobs/{{ object.id }}/delete/" onsubmit="return confirm('Delete this job?');">
        {% csrf_token %}
        <button class="btn btn-outline-danger"><i class="bi bi-trash"></i> Delete Job</button>
      </form>
      <form method="post" action="/jobs/{{ object.id }}/status/" class="d-inline ms-2">
        {% csrf_token %}
        <select name="status" class="form-select d-inline w-auto align-middle">
          <option value="pending" {% if object.status == 'pending' %}selected{% endif %}>Pending offers</option>
          <option value="ongoing" {% if object.status == 'ongoing' %}selected{% endif %}>Ongoing</option>
          <option value="completed" {% if object.status == 'completed' %}selected{% endif %}>Completed</option>
        </select>
        <button class="btn btn-outline-primary align-middle"><i class="bi bi-check2"></i> Update</button>
      </form>
    {% elif user.is_authenticated %}
      <form method="post" action="/proposals/{{ object.id }}/apply/" class="d-inline">
        {% csrf_token %}
        <button class="btn btn-success"><i class="bi bi-send"></i> Apply</button>
      </form>
      <form method="post" action="/proposals/{{ object.id }}/withdraw/" class="d-inline">
        {% csrf_token %}
        <button class="btn btn-outline-secondary"><i class="bi bi-x-circle"></i> Withdraw</button>
      </form>
    {% else %}
      <a class="btn btn-primary" href="/accounts/login/?next=/jobs/{{ object.id }}/">Login to apply</a>
    {% endif %}
  </div>
{% endblock %}


